#  网安实验干货每日分享Tomcat任意文件上传（CVE-2017-12615）-0108  
原创 建哥聊安全  建哥聊安全   2026-01-08 06:24  
  
# Tomcat任意文件上传（CVE-2017-12615）  
## 实验目的  
  
通过本实验，掌握文件上传中的  
Tomcat任意文件上传的漏洞，以及该漏洞影响的Tomcat版本以及配置。  
## 实验环境  
  
·  
操作机：  
Win10  
  
用户名：  
Administrator  
  
密码：  
Sangfor!7890  
  
·  
实验地址：  
http://ip:8080  
## 实验原理  
  
Tomcat配置文件web.xml中，servlet配置了readonly=fasle时，会引发任意文件上传漏洞。  
  
readonly参数默认是true，即不允许delete和put操作，所以通过XMLHttpRequest对象的put或者delete方法访问就会报告http 403错误。但很多时候为了支持REST服务，会设置该属性为false。将readonly参数设置为false时，即可通过PUT方式创建一个JSP文件，并可以执行任意代码。  
  
在  
Tomcat文件夹下的/conf/web.xml文件中，添加readonly参数，属性值为false，即在114行插入以下内容：  
  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/Yxh0GAibwTaNJ7NbLCQuLVHu4mDeHrWXASmM1Gnichpv0DZ48g9lNtfxyUAFAQDHPN96bJvxbTSrkYyJ9BZF6RZw/640?wx_fmt=png&from=appmsg "")  
  
  
修改配置文件完成后需要重启  
Tomcat，重启的方式是双击Tomcat目录下的bin目录下的shutdown.bat，再点击startup.bat。  
  
Tomcat任意文件上传（CVE-2017-12615）漏洞影响的Tomcat版本为：  
  
tomcat7.0.0-7.0.81   
## 实验步骤  
  
1、登录操作机，打开浏览器，输入实验地址：http://ip:8080  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/Yxh0GAibwTaNJ7NbLCQuLVHu4mDeHrWXADqFmo94gKdUib4ngHROkugNSxDTbibj8lNTwDa8gFIqj6Cqyia1CWCXxg/640?wx_fmt=png&from=appmsg "")  
  
2、打开桌面的的“Burp”文件夹，双击“BURP.cmd”启动Burp Suite抓包工具  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/Yxh0GAibwTaNJ7NbLCQuLVHu4mDeHrWXAJduSYnVvibFiarPdAiaiawX80cs6xH3kib7fGicYuMbSS1B18J4icJ1XMjFQg/640?wx_fmt=png&from=appmsg "")  
  
3、切换到“Proxy”代理模块的“Options”，查看Bp的代理，选中该代理，点击左侧的"Edit"，将其端口修改为8088（避免与Tomcat端口冲突）  
  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/Yxh0GAibwTaNJ7NbLCQuLVHu4mDeHrWXAkkEwmUNNngW8VzaTkRkibticmvnF19zYTh4qPWV2BZVKCgYt9j6xicjqA/640?wx_fmt=png&from=appmsg "")  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/Yxh0GAibwTaNJ7NbLCQuLVHu4mDeHrWXAVKK4Xcq1e3wFvWaKibgV8M9LbKqhaHKF5nibkpX0K4JxLiaZelbFcwKiaQ/640?wx_fmt=png&from=appmsg "")  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/Yxh0GAibwTaNJ7NbLCQuLVHu4mDeHrWXAlnq9KbNCIyh9ldibiaQL1Y4SDHicoiaajOvFRv0MGHVDbMg1BtJgxbWoaA/640?wx_fmt=png&from=appmsg "")  
  
4、切换到浏览器，选择火狐插件中的代理（配置浏览器的的代理），选中该代理，将其端口也修改为8088，与Bp的代理一致（注：代理名称可以修改也可以不修改）  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/Yxh0GAibwTaNJ7NbLCQuLVHu4mDeHrWXAMffI6MpUG3H7DZdJunFaMTl1nwXSggicI0399Lws4bTXp2F2Sk9sefw/640?wx_fmt=png&from=appmsg "")  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/Yxh0GAibwTaNJ7NbLCQuLVHu4mDeHrWXA66a5bKO4CpDBd1n3OmDwye1Iia52mHtWpXARtbHSHyCwYDX8cPB73VQ/640?wx_fmt=png&from=appmsg "")  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/Yxh0GAibwTaNJ7NbLCQuLVHu4mDeHrWXAC0BvHJic4sAJ4bBQOTdFLCAMGyd1hP9eyjVqmqpibHTINapor4XGgURw/640?wx_fmt=png&from=appmsg "")  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/Yxh0GAibwTaNJ7NbLCQuLVHu4mDeHrWXAibBnU1oVm9noWBVVrJGWseML9dw7oEoxUwv30hDVEwojh1IqIuWTgww/640?wx_fmt=png&from=appmsg "")  
  
5、刷新网页，Bp成功抓取数据包  
  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/Yxh0GAibwTaNJ7NbLCQuLVHu4mDeHrWXAjIpJotzfHGYOwT2yyyrRwOQTL4BRBroTwvm8KJMlPENECQxuKJ9bUw/640?wx_fmt=png&from=appmsg "")  
  
6、鼠标右击，点击"Send to Repeater"（或者快捷键"Ctrl" + “R”），发送数据包到Repeater模块，然后切换到Repeater模块  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/Yxh0GAibwTaNJ7NbLCQuLVHu4mDeHrWXAVibP5iaDVfzo5viaWUbrPDsoHEXTg7xoqw3icATSCxibgdjbqH884ZtEZMA/640?wx_fmt=png&from=appmsg "")  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/Yxh0GAibwTaNJ7NbLCQuLVHu4mDeHrWXAjgccqRgMTAVquq7xgBSZg7UJEPbzwrA4FBteDib62dtZYV6bTMyUW8g/640?wx_fmt=png&from=appmsg "")  
  
7、修改数据包，尝试上传jsp脚本文件  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/Yxh0GAibwTaNJ7NbLCQuLVHu4mDeHrWXAF8S163TgVaJmlImfldicJCUyJYXA87xFG6G3OliaoQZ0FwSiaIbiaDVNVA/640?wx_fmt=png&from=appmsg "")  
  
8、点击上面的"Send"，发送修改后的数据包，结果返回404，请求被拦截，不能直接上传jsp文件  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/Yxh0GAibwTaNJ7NbLCQuLVHu4mDeHrWXAicI6vKBgjYIZn8J9RrjxkscmVYwEWOV8fuG0qY3wdDPXNEkCktUoXyg/640?wx_fmt=png&from=appmsg "")  
  
9、由于文件名的限制，在数据包中添加"%20"（空格的URL编码），绕过限制，再次点击上面的"Send"，返回201，上传成功  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/Yxh0GAibwTaNJ7NbLCQuLVHu4mDeHrWXACd6EtgM1nFWL8I2aicicLkHWkNSSHNorID9ZDETM9EdbD1KnzibWI7MDg/640?wx_fmt=png&from=appmsg "")  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/Yxh0GAibwTaNJ7NbLCQuLVHu4mDeHrWXABpnGz6YFqPI8RYdUiczic2gFGytcOXJjgBz69yib3gB43jK0ZfFgGAANQ/640?wx_fmt=png&from=appmsg "")  
  
10、关闭浏览器代理  
  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/Yxh0GAibwTaNJ7NbLCQuLVHu4mDeHrWXAXYPbEPibwIicD2MSjkYJxezN8Hyy5W70IDnuJ48vJaNRK4jZbdUiazbBA/640?wx_fmt=png&from=appmsg "")  
  
11、访问http://ip:8080/hack.jsp，新的脚本文件成功解析  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/Yxh0GAibwTaNJ7NbLCQuLVHu4mDeHrWXAvrl2V57ufJ8KgTsjyialH0n1ezaHFn4dbnwtVWqLH2kqXWoqAa1skuA/640?wx_fmt=png&from=appmsg "")  
## 实验总结  
  
掌握文件上传中的  
Tomcat任意文件上传（CVE-2017-12615）漏洞影响的Tomcat版本以及配置文件，利用Burp Suite工具抓取数据包，将数据包内容修改，请求方式修改为PUT方式，上传新建的jsp脚本文件，文件内容可以任意编写，也可以是木马。上传时结果返回404，请求被拦截，不能直接上传jsp文件，是因为有限制：  
  
1. NTFS文件流  
  
2. 文件名相关限制  
  
可以采取一些方法来绕过限制，比如  
Windows中文件名不能以空格结尾，在文件名后面加空格"%20"，也可以加斜杠"/"。  
  
